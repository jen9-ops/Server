<!doctype html>
<html lang="ru">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Self‚ÄëServer (Service Worker) ‚Äî GitHub Pages</title>
<style>
:root{--bg:#0e1422;--fg:#e8eefc;--card:#121a2c;--line:#26324e;--btn:#2d6cdf}
body{margin:0;min-height:100vh;display:grid;place-items:center;background:var(--bg);color:var(--fg);font-family:system-ui,Arial,sans-serif}
.card{width:min(860px,94vw);background:var(--card);border:1px solid var(--line);border-radius:18px;padding:20px;box-shadow:0 20px 50px rgba(0,0,0,.35)}
h1{margin:0 0 8px;font-size:20px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:12px 0}
button{background:var(--btn);color:#fff;border:0;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600}
input{border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--fg);padding:8px}
pre{background:#0b1220;border:1px solid var(--line);border-radius:12px;padding:12px;overflow:auto;max-height:42vh}
.badge{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid var(--line);background:#0b1220;font-size:12px}
</style>
<body>
<div class="card">
<h1>–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º ¬´—Å–µ—Ä–≤–µ—Ä–æ–º¬ª (Service Worker)</h1>
<div class="row">
<span class="badge" id="mode">–†–µ–∂–∏–º: –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
<button id="start">üöÄ –°—Ç–∞—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ (SW)</button>
<button id="run">‚ñ∂ POST api/run</button>
<input id="key" placeholder="–∫–ª—é—á" value="hello" />
<input id="val" placeholder="–∑–Ω–∞—á–µ–Ω–∏–µ" value="–ü—Ä–∏–≤–µ—Ç –∏–∑ GitHub Pages!" />
<button id="save">üíæ POST api/save/:key</button>
<button id="load">üìñ GET api/load/:key</button>
<button id="reload">‚ü≥ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
</div>
<p>–ù–∞–∂–º–∏—Ç–µ ¬´–°—Ç–∞—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞¬ª, —á—Ç–æ–±—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å <b>Service Worker</b>. –û–Ω –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Ç–µ–∫—É—â–µ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ (repo‚Äëpath) –∏ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω—ã–π API. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ CORS –≤–∫–ª—é—á–µ–Ω–∞.</p>
<h3>–í—ã–≤–æ–¥</h3>
<pre id="out">‚Äî</pre>
</div>


<script>
const out = document.getElementById('out');
const mode = document.getElementById('mode');
const log = (s)=> out.textContent = (out.textContent==='‚Äî'? '' : out.textContent+'\n') + s;


// –ë–ê–ó–û–í–´–ô –ü–£–¢–¨ –¥–ª—è GitHub Pages / –æ–±—ã—á–Ω–æ–≥–æ —Ö–æ—Å—Ç–∏–Ω–≥–∞
// –ù–∞–ø—Ä–∏–º–µ—Ä: https://user.github.io/repo/ => BASE "/repo/"
const BASE = (function(){
const p = location.pathname;
return /\/$/.test(p) ? p : p.replace(/[^\/]+$/, '');
})();


function isControlled(){ return !!(navigator.serviceWorker && navigator.serviceWorker.controller); }
function updateMode(){ mode.textContent = '–†–µ–∂–∏–º: ' + (isControlled()? '–æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è Service Worker' : '–æ–±—ã—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞'); }
updateMode();


document.getElementById('reload').onclick = ()=> location.reload();


document.getElementById('start').onclick = async () => {
if (!('serviceWorker' in navigator)) { log('SW –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è'); return; }
try {
const swUrl = new URL('sw.js', location.href).toString();
log('–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é: '+ swUrl + ' (scope='+BASE+')');
const reg = await navigator.serviceWorker.register(swUrl, { scope: BASE });
await navigator.serviceWorker.ready;
reg.active?.postMessage({ type: 'CLAIM' });
setTimeout(()=> location.reload(), 300);
} catch (e) { log('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ SW: ' + e); }
};


document.getElementById('run').onclick = async () => {
out.textContent = '‚Äî';
const r = await fetch(BASE + 'api/run', { method:'POST' });
log(await r.text());
};
</html>
