<!doctype html>
<html lang="ru">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Self‚ÄëServer (Service Worker) ‚Äî GitHub Pages</title>
<!-- –í–ê–ñ–ù–û: base –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ URL (sw.js, api/...) –∏–¥—É—Ç –∏–∑ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è -->
<base href="./">
<style>
:root{--bg:#0e1422;--fg:#e8eefc;--card:#121a2c;--line:#26324e;--btn:#2d6cdf}
body{margin:0;min-height:100vh;display:grid;place-items:center;background:var(--bg);color:var(--fg);font-family:system-ui,Arial,sans-serif}
.card{width:min(860px,94vw);background:var(--card);border:1px solid var(--line);border-radius:18px;padding:20px;box-shadow:0 20px 50px rgba(0,0,0,.35)}
h1{margin:0 0 8px;font-size:20px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:12px 0}
button{background:var(--btn);color:#fff;border:0;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600}
input{border-radius:10px;border:1px solid var(--line);background:#0b1220;color:var(--fg);padding:8px}
pre{background:#0b1220;border:1px solid var(--line);border-radius:12px;padding:12px;overflow:auto;max-height:42vh}
.badge{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid var(--line);background:#0b1220;font-size:12px}
</style>
<body>
<div class="card">
<h1>–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º ¬´—Å–µ—Ä–≤–µ—Ä–æ–º¬ª (Service Worker)</h1>
<div class="row">
<span class="badge" id="mode">–†–µ–∂–∏–º: –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
<button id="start">üöÄ –°—Ç–∞—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ (SW)</button>
<button id="run">‚ñ∂ POST api/run</button>
<input id="key" placeholder="–∫–ª—é—á" value="hello" />
<input id="val" placeholder="–∑–Ω–∞—á–µ–Ω–∏–µ" value="–ü—Ä–∏–≤–µ—Ç –∏–∑ GitHub Pages!" />
<button id="save">üíæ POST api/save/:key</button>
<button id="load">üìñ GET api/load/:key</button>
<button id="reload">‚ü≥ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
<button id="reset">üßπ Unregister SW + Clear caches</button>
</div>
<p>–ù–∞–∂–º–∏—Ç–µ ¬´–°—Ç–∞—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞¬ª, —á—Ç–æ–±—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å <b>Service Worker</b>. –û–Ω –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–∏ –∏ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω—ã–π API. CORS –≤–∫–ª—é—á—ë–Ω.</p>
<h3>–í—ã–≤–æ–¥</h3>
<pre id="out">‚Äî</pre>
</div>


<script>
const out = document.getElementById('out');
const mode = document.getElementById('mode');
const log = (s) => out.textContent = (out.textContent === '‚Äî' ? '' : out.textContent + '
') + s; }
function updateMode(){ mode.textContent = '–†–µ–∂–∏–º: ' + (isControlled()? '–æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è Service Worker' : '–æ–±—ã—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞'); }
updateMode();


document.getElementById('reload').onclick = ()=> location.reload();


document.getElementById('reset').onclick = async ()=>{
if (!('serviceWorker' in navigator)) return;
const regs = await navigator.serviceWorker.getRegistrations();
for (const r of regs) await r.unregister();
if (window.caches) { const keys = await caches.keys(); for (const k of keys) await caches.delete(k); }
log('SW –∏ Cache –æ—á–∏—â–µ–Ω—ã. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—é...');
setTimeout(()=>location.reload(), 300);
};


document.getElementById('start').onclick = async () => {
if (!('serviceWorker' in navigator)) { log('SW –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è'); return; }
try {
// –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º sw.js –≤ –¢–ï–ö–£–©–ï–ô –ø–∞–ø–∫–µ, scope=./ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥
const reg = await navigator.serviceWorker.register('sw.js', { scope: './' });
await navigator.serviceWorker.ready;


// –ï—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ –µ—â—ë –Ω–µ –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º ‚Äî –∂–¥—ë–º controllerchange
if (!navigator.serviceWorker.controller) {
await new Promise(resolve => navigator.serviceWorker.addEventListener('controllerchange', resolve, { once:true }));
}


// –ü—Ä–æ—Å–∏–º SW —Å—Ä–∞–∑—É –∑–∞–±—Ä–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
reg.active?.postMessage({ type: 'CLAIM' });

  </script>
  </html>
